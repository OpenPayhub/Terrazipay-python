# X402：从 Client -> Server -> On-Chain 的可编程支付流程设想

> 本文档用于说明一个基于 **X402 思想** 的完整支付流程实现与架构设想。  
> 代码层面的具体实现方式，从发起到收款验证，详见： [x402_mock](../src/terrazip/x402_mock/README.cn.md) 。

---

## 1. 背景与动机

在 Agent / Tool / LLM 驱动的应用中，**“请求即价值”** 正逐渐成为一种常态：

- Agent 访问资源前，需要先完成支付或授权
- Server 希望在**不托管私钥**的前提下完成收费
- 支付行为需要可组合、可验证、可链上结算

传统方案往往存在以下问题：

- ❌ 支付与请求解耦，流程割裂  
- ❌ Server 需要信任 Client 或依赖中心化支付网关  
- ❌ 无法在 Agent 自动决策链路中自然嵌入支付  

**X402** 的核心思想，是将支付能力纳入一次「协议化的请求流程」中。

---

## 2. 什么是 X402（概念性说明）

X402 并不是某一个具体实现，而是一种**约定式流程**：

- 通过 `402 Payment Required` 表达资源访问前置条件  
- 由 Client 主动发起支付意图  
- Server 验证支付能力 / 授权后继续服务  

在 Web2 语义中，402 是一个几乎未被使用的状态码；  
而在 Web3 / Agent 世界中，它恰好可以承载 **“可编程支付门槛”** 的角色。

---

## 3. 本项目的整体流程概览

本项目实现了一个完整的三段式流程：
![Workflow](/assets/work_flow.png)


## 延伸阅读

- Coinbase 对 X402 的探索与实现：
  https://github.com/coinbase/x402